{% extends "base.html" %}
{% load static %}
{% load filters %}

{% block titulo %} Planilla {% endblock %}
{% block navlinks %}
    {% include "components/nav_links.html" with seleccionado="Planilla" %}
{% endblock %}
{% block contenido %}
<form method="post" action="/planilla" id="formPlanilla" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="hidden" opciones="{{ acciones_submit }}" name="accion_submit" id="hdnAccionSubmit" value="{{ accion_submit }}">
    <input type="hidden" name="mesReporte" value="{{ mesReporte }}">
    <input type="hidden" name="anioReporte" value="{{ anioReporte }}">
    {% if mostrarMensaje %}
    <div class="alert alert-success auto-hide-5s" role="alert">
        {% if statusPlanilla == "Presentado" %}
        La planilla se presentó exitosamente
        {% else %}
        Los cambios en la planilla se han guardado exitosamente
        {% endif %}
    </div>
    {% endif %}
    <div class="card mb-4">
        <div class="card-header">
            <h3>EMPRESA ABC - REPORTE HORARIO</h3>
            <h4>{{ nombreMesReporte }} {{ anioReporte }}</h4>
            <div class="d-flex flex-row mt-4">
                <h5 class="w-25"><b>Legajo:</b> {{ datosEmpleado.legajo }}</h5>
                {% with nombre_completo=datosEmpleado.apellidos|add:", "|add:datosEmpleado.nombres %}
                <h5 class="w-75"><b>Apellido(s) y nombre(s):</b> {{ nombre_completo }}</h5>
                {% endwith %}
            </div>
            <div class="mt-1rem">
                <h5><b>Observaciones:</b> {{ datosPlanilla.observaciones }}</h5>
            </div>
        </div>
        <div class="card-body">
            <table class="table table-striped table-bordered w-0">
                <thead>
                    <tr>
                        <th>
                            Día
                        </th>
                        <th>
                            Código
                        </th>
                        <th class="w-100">
                            Observaciones
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for datoDiario in datosDiarios %}
                        <tr>
                            <td class="text-center">{{ forloop.counter }}</td>
                            <td class="text-center">
                                {% if datosPlanilla.status.status == "Borrador" %}
                                <select class="w-100 input-registro-diario" name="codigos">
                                    <option value="sn" {% if datoDiario.codigo == "sn" %}{{"selected"}}{%endif%}>S/N</option>
                                    <option value="v" {% if datoDiario.codigo == "v" %}{{"selected"}}{%endif%}>V</option>
                                    <option value="cs" {% if datoDiario.codigo == "cs" %}{{"selected"}}{%endif%}>CS</option>
                                    <option value="sa" {% if datoDiario.codigo == "sa" %}{{"selected"}}{%endif%}>SA</option>

                                    <!--

                                    <option value="-" {% if datoDiario.codigo == "-" %}{{"selected"}}{%endif%}>-</option>
                                    <option value=":" {% if datoDiario.codigo == ":" %}{{"selected"}}{%endif%}>:</option>
                                    <option value="+" {% if datoDiario.codigo == "+" %}{{"selected"}}{%endif%}>+</option>
                                    <option value="D" {% if datoDiario.codigo == "D" %}{{"selected"}}{%endif%}>D</option>
                                    <option value="E" {% if datoDiario.codigo == "E" %}{{"selected"}}{%endif%}>E</option>
                                    <option value="H" {% if datoDiario.codigo == "H" %}{{"selected"}}{%endif%}>H</option>
                                    <option value="L" {% if datoDiario.codigo == "L" %}{{"selected"}}{%endif%}>L</option>
                                    <option value="M" {% if datoDiario.codigo == "M" %}{{"selected"}}{%endif%}>M</option>
                                    <option value="N" {% if datoDiario.codigo == "N" %}{{"selected"}}{%endif%}>N</option>
                                    <option value="P" {% if datoDiario.codigo == "P" %}{{"selected"}}{%endif%}>P</option>
                                    <option value="R" {% if datoDiario.codigo == "R" %}{{"selected"}}{%endif%}>R</option>
                                    <option value="W" {% if datoDiario.codigo == "W" %}{{"selected"}}{%endif%}>W</option>
                                    <option value="Y" {% if datoDiario.codigo == "Y" %}{{"selected"}}{%endif%}>Y</option>
                                    <option value="Z" {% if datoDiario.codigo == "Z" %}{{"selected"}}{%endif%}>Z</option>
                                    <option value="CS" {% if datoDiario.codigo == "CS" %}{{"selected"}}{%endif%}>CS</option>
                                    <option value="FR" {% if datoDiario.codigo == "FR" %}{{"selected"}}{%endif%}>FR</option>
                                    <option value="JA" {% if datoDiario.codigo == "JA" %}{{"selected"}}{%endif%}>JA</option>
                                    <option value="JH" {% if datoDiario.codigo == "JH" %}{{"selected"}}{%endif%}>JH</option>
                                    <option value="ZD" {% if datoDiario.codigo == "ZD" %}{{"selected"}}{%endif%}>ZD</option>
                                    <option value="LAR" {% if datoDiario.codigo == "LAR" %}{{"selected"}}{%endif%}>LAR</option>
                                    <option value="CMP" {% if datoDiario.codigo == "CMP" %}{{"selected"}}{%endif%}>CMP</option>
                                    <option value="CMT" {% if datoDiario.codigo == "CMT" %}{{"selected"}}{%endif%}>CMT</option>
                                    <option value="CSE" {% if datoDiario.codigo == "CSE" %}{{"selected"}}{%endif%}>CSE</option>
                                    <option value="FF1" {% if datoDiario.codigo == "FF1" %}{{"selected"}}{%endif%}>FF1</option>
                                    <option value="FF2" {% if datoDiario.codigo == "FF2" %}{{"selected"}}{%endif%}>FF2</option>
                                    <option value="JLM" {% if datoDiario.codigo == "JLM" %}{{"selected"}}{%endif%}>JLM</option>
                                    <option value="MEX" {% if datoDiario.codigo == "MEX" %}{{"selected"}}{%endif%}>MEX</option>
                                    <option value="QTI" {% if datoDiario.codigo == "QTI" %}{{"selected"}}{%endif%}>QTI</option>
                                    <option value="QCO" {% if datoDiario.codigo == "QCO" %}{{"selected"}}{%endif%}>QCO</option>
                                    <option value="VRE" {% if datoDiario.codigo == "VRE" %}{{"selected"}}{%endif%}>VRE</option>
                                    <option value="X" {% if datoDiario.codigo == "X" %}{{"selected"}}{%endif%}>X</option>
                                    <option value="UNP" {% if datoDiario.codigo == "UNP" %}{{"selected"}}{%endif%}>UNP</option>
                                    <option value="UNT" {% if datoDiario.codigo == "UNT" %}{{"selected"}}{%endif%}>UNT</option>
                                    <option value="UNU" {% if datoDiario.codigo == "UNU" %}{{"selected"}}{%endif%}>UNU</option>

                                    -->
                                </select>
                                {% else %}
                                {{ datoDiario.codigo|etiqueta_codigo }}
                                {% endif %}
                            </td>
                            <td>
                                {% if datosPlanilla.status.status == "Borrador" %}
                                <input class="w-100 input-registro-diario" placeholder="{{ textoSinNovedad }}" type="text" name="observaciones" id="observacion_{{i}}" value="{{datoDiario.observaciones}}">
                                {% else %}
                                {% if datoDiario.observaciones == "" %}{{ textoSinNovedad }}{% else %}{{ datoDiario.observaciones }}{% endif %}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="card">
                <h5 class="card-header bg-secondary text-white">Adjuntar archivo</h5>
                {% if nombreArchivoAdjunto != "" %}
                <div class="card-body" id="area-adjunto" contiene-archivo="true">
                    <a href="download">
                        <div id="wrapperNombreArchivo">
                            <i class='bi bi-file-earmark-pdf'></i>
                            <div id="nombreArchivo">{{ nombreArchivoAdjunto }}</div>
                        </div>
                    </a>
                </div>
                {% else %}
                <div class="card-body" id="area-adjunto">
                    <div id="noFilesSelectedText" class="bg-texto">
                        <a class="file-input-anchor" onclick="fileInputOpen()">Haz click aquí</a>&nbsp;o arrastra un archivo para adjuntar
                    </div>
                    <div id="wrapperNombreArchivo" class="d-none">
                        <i class='bi bi-file-earmark-pdf'></i>
                        <div id="nombreArchivo"></div>
                    </div>
                    <input type="file" name="pdf" id="pdf">
                </div>
                {% endif %}
            </div>
            <br>
            {% if datosPlanilla.status.status == "Borrador" %}
            <div class="d-flex flex-row w-100 justify-content-center">
                <button id="btnLimpiarForm" class="btn btn-danger" type="button">Limpiar formulario</button>
                <button id="btnGuardarCambios" class="btn btn-primary ml-1rem" type="submit">Guardar cambios</button>
                {% if nombreArchivoAdjunto == "" %}
                    <button id="btnPresentarPlanilla" class="btn btn-success ml-1rem" type="button" disabled>Presentar planilla</button>
                {% else %}
                    <button id="btnPresentarPlanilla" class="btn btn-success ml-1rem" type="button">Presentar planilla</button>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% if datosPlanilla.status.status == "Presentado" %}
        <div class="card-footer text-success">
            Estado: Presentado
        {% else %}
        <div class="card-footer text-danger">
            Estado: Borrador
        {% endif %}
        </div>
    </div>
</form>

<script type="text/javascript" src="{% static 'js/planilla.js' %}"></script>
{% endblock %}